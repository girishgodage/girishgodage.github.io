<!DOCTYPE html>
<html lang="en">

<head>
     
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Chrome, Firefox OS and Opera -->
<meta name="theme-color" content="#2A80EE">
<!-- Windows Phone -->
<meta name="msapplication-navbutton-color" content="#2A80EE">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-status-bar-style" content="#2A80EE">
<title>ASP. NET Core -OutputFormatter &#8211; Girish Godage</title>
<meta name="description" content="In this seventh chapter I want to write about, how to send your data in different formats and types to the client. By default the ASP.NET Core Web API sends the data as JSON, but there are some more ways to send the data.">
<meta name="keywords" content="AspDotnetCoreCustomize">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all">

<!-- Verifications -->
    
    
        
<!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="ASP. NET Core -OutputFormatter">
    <meta property="og:description" content="I am a passionate Leader, who has a good command in technology &amp; Mangement. Also, I am a creative designer and an innovatie techie.">
    <meta property="og:url" content="http://localhost:4000/blog/customize-outputformatter">
    <meta property="og:site_name" content="Girish Godage">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@GGodage" />
    
    <meta name="twitter:title" content="ASP. NET Core -OutputFormatter" />
    <meta name="twitter:description" content="In this seventh chapter I want to write about, how to send your data in different formats and types to the client. By default the ASP.NET Core Web API sends the data as JSON, but there are some more ways to send the data." />
    <meta name="twitter:url" content="http://localhost:4000/blog/customize-outputformatter" />

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/img/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/img/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/img/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
    


    <link rel="canonical" href="http://localhost:4000/blog/customize-outputformatter">
<link rel="alternate" type="application/rss+xml" title="RSS Feed for Girish Godage" href="/feed.xml" />
    <!-- Bootstrap CSS-->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <!-- Google fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Advent+Pro">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Varela+Round">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abel">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
   
    <!-- owl carousel-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.carousel.css" >
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.theme.css">
    
    <!-- animate.css-->
    <link rel="stylesheet" href="http://localhost:4000/sitejs/animate.css/animate.css">
    <!-- theme stylesheet-->
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="http://localhost:4000/css/custom.css" as="style">
    <link rel="stylesheet" href="http://localhost:4000/css/comments.css" as="style">
    <!-- Favicon-->
    <link rel="shortcut icon" href="http://localhost:4000/img/logo-big.png">
    <!-- Fab Icon-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-mfizz/2.4.1/font-mfizz.min.css">
    
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-130164763-2', 'auto');
       ga('send', 'pageview');
    </script>
    
    <!-- Typed.js DONT TOUCHHHHHHHHHHHHH!-->
    <!--<script src="https://cdn.rawgit.com/mattboldt/typed.js/master/lib/typed.min.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.9/typed.min.js"></script>
    <script>
        function copyToClipboard(element) {
            var $temp = $("<input>");
            $("body").append($temp);
            $temp.val($(element).text()).select();
            document.execCommand("copy");
            $temp.remove();
        }
      </script>
      
      <!-- START OF RELEVANT PART -->
    <script async src="https://just-comments.com/w2.js"></script>
    <!-- END OF RELEVANT PART -->


</head>

<body>
    
<!-- navbar-->
<header class="header">
  <nav class="navbar navbar-expand-lg fixed-top">
    <div class="container"><a class="navbar-brand" href="http://localhost:4000"><img
          src="http://localhost:4000/img/logo-big.png" width="50" height="50" class="d-inline-block align-center"
          alt="logo"> <img src="http://localhost:4000/img/girish_logo.png" height="30" alt="girilogo"></a>
      <button type="button" data-toggle="collapse" data-target="#navbarcollapse" aria-controls="navbarSupportedContent"
        aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler navbar-toggler-right"><span
          class="fa fa-bars" style="color: white"></span></button>
      <div id="navbarcollapse" class="collapse navbar-collapse">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item"><a href="http://localhost:4000#home" class="nav-link  link-scroll">Home</a></li>
          <li class="nav-item"><a href="http://localhost:4000#about" class="nav-link link-scroll">About</a></li>
          <li class="nav-item"><a href="http://localhost:4000#skills" class="nav-link link-scroll">Skills</a>
          </li>
          <li class="nav-item"><a href="http://localhost:4000#services" class="nav-link link-scroll">Services</a>
          </li>
          <li class="nav-item"><a href="http://localhost:4000#references" class="nav-link link-scroll">My
              work</a></li>
          <li class="nav-item"><a href="http://localhost:4000#contact" class="nav-link link-scroll">Contact</a>
          </li>
          <li class="nav-item"><a href="http://localhost:4000/blog" class="nav-link link-scroll">Blog</a></li>
        </ul>
      </div>
    </div>
  </nav>
</header>

    
    
    
    <div style="background-color:Gray;">
        <div style="padding:0;min-height:95.05vh;display:flex;font-family: Poppins, sans-serif;margin-top: 5rem;"
            class="container">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <p class="post-title">
                    <h1><a href="/blog/customize-outputformatter">ASP. NET Core -OutputFormatter</a></h1>
                </p>
                
                <span class="post-meta">
              <span style="font-weight:600">November 01, 2019 Friday</span>
                    
                       ( 8 minute read ) 
                    
                     
                    <a style="font-weight:600" href="https://twitter.com/girishgodage_007" target="_blank">   by Girish Godage</a>
                </span>
                
                <div class="site-category"> 
                        <h5>AspDotnetCoreCustomize</h5>
                </div>
                
                <hr>
                <div><img class="post-image" src="/img/aspnetcore.png" alt="ASP. NET Core -OutputFormatter" height="250" /></div>
                <div class="post-content">
                    <br>                     
                    <h2 id="outputformatter">OutputFormatter</h2>

<p>In this seventh chapter I want to write about, how to send your data in different formats and types to the client. By default the ASP.NET Core Web API sends the data as JSON, but there are some more ways to send the data.</p>

<h2 id="about-outputformatters">About OutputFormatters</h2>

<p>OutputFormatters are classes that turn your data into a different format to sent them trough HTTP to the clients. Web API uses a default OutputFormatter to turn objects into JSON, which is the default format to send data in a structured way. Other built-in formatters are a XML formatter and a plain text formatter.</p>

<p>With the - so called - content negotiation the client is able to decide which format he wants to retrieve .The client needs to specify the content type of the format in the Accept-Header. The content negotiation is implemented in the ObjectResult.</p>

<p>By default the Web API always returns JSON, even if you accept <code class="highlighter-rouge">text/xml</code> in the header. This is why the build in XML formatter is not registered by default. There are two ways to add a <code class="highlighter-rouge">XmlSerializerOutputFormatter</code> to ASP.NET Core:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">AddXmlSerializerFormatters</span><span class="p">();</span>
</code></pre></div></div>

<p>or</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">AddMvcOptions</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">options</span><span class="p">.</span><span class="n">OutputFormatters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">XmlSerializerOutputFormatter</span><span class="p">());</span>
    <span class="p">});</span>
</code></pre></div></div>

<blockquote>
  <p>There is also a XmlDataContractSerializerOutputFormatter available.</p>
</blockquote>

<p>Also any Accept header gets turned into <code class="highlighter-rouge">application/json</code>. If you want to allow the clients to accept different headers, you need to switch that translation off:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">services.AddControllers()</span><span class="w">
    </span><span class="err">.AddMvcOptions(options</span><span class="w"> </span><span class="err">=&gt;</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="err">options.RespectBrowserAcceptHeader</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="kc">true</span><span class="err">;</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">default</span><span class="w">
    </span><span class="p">}</span><span class="err">);</span><span class="w">
</span></code></pre></div></div>

<p>Some third party components that don’t completely support ASP.NET Core 3.0, don’t write asynchronously to the response stream, but ASP.NET Core 3.0 doesn’t allow to write synchronously by default. To enable synchronous writing access you need to add these lines to the <code class="highlighter-rouge">ConfigureServices</code> method:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">KestrelServerOptions</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">options</span><span class="p">.</span><span class="n">AllowSynchronousIO</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<p>To try the formatters let’s setup a small test project.</p>

<h2 id="prepare-a-test-project">Prepare a test project</h2>

<p>Using the console we will create a small ASP.NET Core Web API project. Execute the following commands line by line:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dotnet new webapi <span class="nt">-n</span> OutputFormatterSample <span class="nt">-o</span> OutputFormatterSample
<span class="nb">cd </span>WebApiTest
dotnet add package GenFu
dotnet add package CsvHelper
</code></pre></div></div>

<p>This creates a new Web API projects and adds two NuGet packages to it. GenFu is an awesome library to easily create test data. The second one helps us to easily write CSV data.</p>

<p>Now open the project in Visual Studio or in Visual Studio Code and open the <code class="highlighter-rouge">ValuesController.cs</code> and change the <code class="highlighter-rouge">Get()</code> method like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
<span class="k">public</span> <span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;&gt;</span> <span class="nf">Get</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">var</span> <span class="n">persons</span> <span class="p">=</span> <span class="n">A</span><span class="p">.</span><span class="n">ListOf</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="m">25</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">persons</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This crates a list of 25 Persons using GenFu. The properties get automatically filled with almost realistic data. You’ll see the magic of GenFu and the results later on.</p>

<p>In the models folder create a new file <code class="highlighter-rouge">Person.cs</code> with the the <code class="highlighter-rouge">Person</code> class inside:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Age</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">EmailAddress</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Address</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">City</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Phone</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Open the <code class="highlighter-rouge">Startup.cs</code> as well and add the Xml formatters and allow other accept headers as described earlier:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">AddMvcOptions</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="p">{</span>	
        <span class="n">options</span><span class="p">.</span><span class="n">RespectBrowserAcceptHeader</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="c1">// false by default</span>
        <span class="n">options</span><span class="p">.</span><span class="n">OutputFormatters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">XmlSerializerOutputFormatter</span><span class="p">());</span>
    <span class="p">});</span>
</code></pre></div></div>

<p>That’s it for now. Now you are able to retrieve the data from the Web API. Start the project by using the <code class="highlighter-rouge">dotnet run</code> command.</p>

<p>The best tools to test a web API are Fiddler or Postman. I prefer Postman because it is easy to use. At the end it doesn’t matter which tool you want to use. In these demos here I’m going to use Postman.</p>

<p>Inside Postman I create a new request. I write the API url into the address field, which is https://localhost:5001/api/values and I add a header with the key <code class="highlighter-rouge">Accept</code> and the Value <code class="highlighter-rouge">application/json</code>.</p>

<p>After I press send I will see the JSON result in the response body below:</p>

<p><img src="images/customize-aspnetcore/custom-formatter-json.PNG" alt="" /></p>

<p>Here you can see the auto generated values. GenFu puts the data in based on the property type and the property name. So it puts real first names and real last names as well as real cities and phone numbers into the Person’s properties.</p>

<p>Now let’s test the XML output formatter.</p>

<p>In postman change the Accept header form <code class="highlighter-rouge">application/json</code> to <code class="highlighter-rouge">text/xml</code> and press send:</p>

<p><img src="images/customize-aspnetcore/custom-formatter-xml.PNG" alt="" /></p>

<p>We now have an XML formatted output.</p>

<p>Now let’s go a step aheads and create some custom OutputFormatters.</p>

<h2 id="custom-outputformatters">Custom OutputFormatters</h2>

<p>The plan is to create an VCard output to be able to import the person’s contacts directly to outlook or any other contact database that supports VCards. Later in this section we also want to create a CSV output formatter.</p>

<p>Both are text based output formatters and will derive from <code class="highlighter-rouge">TextOutputFormatter</code>. Create a new class in a new file called <code class="highlighter-rouge">VcardOutputFormatter.cs</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">VcardOutputFormatter</span> <span class="p">:</span> <span class="n">TextOutputFormatter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">ContentType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">VcardOutputFormatter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">SupportedMediaTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">MediaTypeHeaderValue</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="s">"text/vcard"</span><span class="p">));</span>

        <span class="n">SupportedEncodings</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">);</span>
        <span class="n">SupportedEncodings</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Unicode</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// optional, but makes sense to restrict to a specific condition</span>
    <span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">CanWriteType</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Person</span><span class="p">).</span><span class="nf">IsAssignableFrom</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> 
            <span class="p">||</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;).</span><span class="nf">IsAssignableFrom</span><span class="p">(</span><span class="n">type</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">base</span><span class="p">.</span><span class="nf">CanWriteType</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// this needs to be overwritten</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Task</span> <span class="nf">WriteResponseBodyAsync</span><span class="p">(</span>
    	<span class="n">OutputFormatterWriteContext</span> <span class="n">context</span><span class="p">,</span> 
    	<span class="n">Encoding</span> <span class="n">selectedEncoding</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">serviceProvider</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">.</span><span class="n">RequestServices</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">logger</span> <span class="p">=</span> <span class="n">serviceProvider</span>
        	<span class="p">.</span><span class="nf">GetService</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ILogger</span><span class="p">&lt;</span><span class="n">VcardOutputFormatter</span><span class="p">&gt;))</span> <span class="k">as</span> <span class="n">ILogger</span><span class="p">;</span>

        <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">.</span><span class="n">Response</span><span class="p">;</span>

        <span class="kt">var</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Object</span> <span class="k">is</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span>
        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">person</span> <span class="k">in</span> <span class="n">context</span><span class="p">.</span><span class="n">Object</span> <span class="k">as</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span>
            <span class="p">{</span>
                <span class="nf">FormatVcard</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span> <span class="n">logger</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Object</span> <span class="k">as</span> <span class="n">Person</span><span class="p">;</span>
            <span class="nf">FormatVcard</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">person</span><span class="p">,</span> <span class="n">logger</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="nf">WriteAsync</span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">FormatVcard</span><span class="p">(</span>
    	<span class="n">StringBuilder</span> <span class="n">buffer</span><span class="p">,</span> 
    	<span class="n">Person</span> <span class="n">person</span><span class="p">,</span> 
    	<span class="n">ILogger</span> <span class="n">logger</span><span class="p">)</span>
    <span class="p">{</span>
		<span class="n">buffer</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span><span class="s">"BEGIN:VCARD"</span><span class="p">);</span>
		<span class="n">buffer</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span><span class="s">"VERSION:2.1"</span><span class="p">);</span>
		<span class="n">buffer</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span><span class="s">$"FN:</span><span class="p">{</span><span class="n">person</span><span class="p">.</span><span class="n">FirstName</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="n">person</span><span class="p">.</span><span class="n">LastName</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
		<span class="n">buffer</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span><span class="s">$"N:</span><span class="p">{</span><span class="n">person</span><span class="p">.</span><span class="n">LastName</span><span class="p">}</span><span class="s">;</span><span class="p">{</span><span class="n">person</span><span class="p">.</span><span class="n">FirstName</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
		<span class="n">buffer</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span><span class="s">$"EMAIL:</span><span class="p">{</span><span class="n">person</span><span class="p">.</span><span class="n">EmailAddress</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
		<span class="n">buffer</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span><span class="s">$"TEL;TYPE=VOICE,HOME:</span><span class="p">{</span><span class="n">person</span><span class="p">.</span><span class="n">Phone</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
		<span class="n">buffer</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span><span class="s">$"ADR;TYPE=home:;;</span><span class="p">{</span><span class="n">person</span><span class="p">.</span><span class="n">Address</span><span class="p">}</span><span class="s">;</span><span class="p">{</span><span class="n">person</span><span class="p">.</span><span class="n">City</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>            
		<span class="n">buffer</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span><span class="s">$"UID:</span><span class="p">{</span><span class="n">person</span><span class="p">.</span><span class="n">Id</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
		<span class="n">buffer</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span><span class="s">"END:VCARD"</span><span class="p">);</span>
		<span class="n">logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Writing </span><span class="p">{</span><span class="n">person</span><span class="p">.</span><span class="n">FirstName</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="n">person</span><span class="p">.</span><span class="n">LastName</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the constructor we need to specify the supported media types and encodings. In the method <code class="highlighter-rouge">CanWriteType()</code> we need to check whether the current type is supported within this output formatters. Here we only want to format a single <code class="highlighter-rouge">Person</code> or a list of <code class="highlighter-rouge">Persons</code>.</p>

<p>The method <code class="highlighter-rouge">WriteResponseBodyAsync()</code> then actually writes the list of persons out to the response stream via a <code class="highlighter-rouge">StringBuilder</code>.</p>

<p>At least we need to register the new <code class="highlighter-rouge">VcardOutputFormatter</code> in the <code class="highlighter-rouge">Startup.cs</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">AddMvcOptions</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">options</span><span class="p">.</span><span class="n">RespectBrowserAcceptHeader</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="c1">// false by default</span>
        <span class="n">options</span><span class="p">.</span><span class="n">OutputFormatters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">XmlSerializerOutputFormatter</span><span class="p">());</span>

        <span class="c1">// register the VcardOutputFormatter</span>
        <span class="n">options</span><span class="p">.</span><span class="n">OutputFormatters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">VcardOutputFormatter</span><span class="p">());</span> 
    <span class="p">});</span>

</code></pre></div></div>

<p>Start the app again using <code class="highlighter-rouge">dotnet run</code>. Now change the Accept header to <code class="highlighter-rouge">text/vcard</code> and let’s see what happens:</p>

<p><img src="images/customize-aspnetcore/custom-formatter-vcard.PNG" alt="" /></p>

<p>We now should see our date in the VCard format.</p>

<p>Let’s do the same for a CSV output. We already added the CsvHelper library to the project, so you can just copy the next snippet into your project:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">CsvOutputFormatter</span> <span class="p">:</span> <span class="n">TextOutputFormatter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">ContentType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">CsvOutputFormatter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">SupportedMediaTypes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">MediaTypeHeaderValue</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="s">"text/csv"</span><span class="p">));</span>

        <span class="n">SupportedEncodings</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">);</span>
        <span class="n">SupportedEncodings</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">Unicode</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// optional, but makes sense to restrict to a specific condition</span>
    <span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">CanWriteType</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Person</span><span class="p">).</span><span class="nf">IsAssignableFrom</span><span class="p">(</span><span class="n">type</span><span class="p">)</span>
            <span class="p">||</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;).</span><span class="nf">IsAssignableFrom</span><span class="p">(</span><span class="n">type</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">base</span><span class="p">.</span><span class="nf">CanWriteType</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// this needs to be overwritten</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">Task</span> <span class="nf">WriteResponseBodyAsync</span><span class="p">(</span>
    	<span class="n">OutputFormatterWriteContext</span> <span class="n">context</span><span class="p">,</span> 
    	<span class="n">Encoding</span> <span class="n">selectedEncoding</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">serviceProvider</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">.</span><span class="n">RequestServices</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">logger</span> <span class="p">=</span> <span class="n">serviceProvider</span>
        	<span class="p">.</span><span class="nf">GetService</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ILogger</span><span class="p">&lt;</span><span class="n">CsvOutputFormatter</span><span class="p">&gt;))</span> <span class="k">as</span> <span class="n">ILogger</span><span class="p">;</span>

        <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">HttpContext</span><span class="p">.</span><span class="n">Response</span><span class="p">;</span>

        <span class="kt">var</span> <span class="n">csv</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CsvWriter</span><span class="p">(</span><span class="k">new</span> <span class="nf">StreamWriter</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">Body</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Object</span> <span class="k">is</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">persons</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Object</span> <span class="k">as</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;;</span>
            <span class="n">csv</span><span class="p">.</span><span class="nf">WriteRecords</span><span class="p">(</span><span class="n">persons</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Object</span> <span class="k">as</span> <span class="n">Person</span><span class="p">;</span>
            <span class="n">csv</span><span class="p">.</span><span class="n">WriteRecord</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="n">person</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="n">CompletedTask</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>This almost works the same way. We can pass the response stream via a <code class="highlighter-rouge">StreamWriter</code> directly into the <code class="highlighter-rouge">CsvWriter</code>. After that we are able to feed the writer with the persons or the list of persons. That’s it.</p>

<p>We also need to register the <code class="highlighter-rouge">CsvOutputFormatter</code> before we can test it.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">AddMvcOptions</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">options</span><span class="p">.</span><span class="n">RespectBrowserAcceptHeader</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> <span class="c1">// false by default</span>
        <span class="n">options</span><span class="p">.</span><span class="n">OutputFormatters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">XmlSerializerOutputFormatter</span><span class="p">());</span>

        <span class="c1">// register the VcardOutputFormatter</span>
        <span class="n">options</span><span class="p">.</span><span class="n">OutputFormatters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">VcardOutputFormatter</span><span class="p">());</span> 
        <span class="c1">// register the CsvOutputFormatter</span>
        <span class="n">options</span><span class="p">.</span><span class="n">OutputFormatters</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">CsvOutputFormatter</span><span class="p">());</span> 
    <span class="p">});</span>
</code></pre></div></div>

<p>In Postman change the <code class="highlighter-rouge">Accept</code> header to <code class="highlighter-rouge">text/csv</code> and press send again:</p>

<p><img src="images/customize-aspnetcore/custom-formatter-csv.PNG" alt="" /></p>

<h2 id="conclusion">Conclusion</h2>

<p>Isn’t that cool? I really like the way to change the format based on the except header. This way you are able to create an Web API for many different clients and one that accepts many different formats. There are still a lot of potential clients out there which don’t use JSON and prefer XML or CSV.</p>

<p>The other way around would be an option to consume CSV or any other format inside the Web API. Let’s assume your client would send you a list of persons in CSV format. How would you solve this? Parsing the string manually in the action method would work, but it’s not a nice option. This is what <strong>ModelBinders</strong> can do for us. Let’s see how this works in the next chapter.</p>

<hr />
<h2 id="sessions">Sessions</h2>

<p>This is series of articles on Building Conf planner app with Asp.net Core:</p>

<ul>
  <li><a href="/blog/customize-logging" target="_blank">1 - Logging</a></li>
  <li><a href="/blog/customize-configuration" target="_blank">2 - Configuration</a></li>
  <li><a href="/blog/customize-dependency-injection" target="_blank">3 - Dependency Injection</a></li>
  <li><a href="/blog/customize-https" target="_blank">4 - Https</a></li>
  <li><a href="/blog/customize-hostedservices" target="_blank">5 - Hostedservices</a></li>
  <li><a href="/blog/customize-middleware" target="_blank">6 - Middlewares</a></li>
  <li><a href="/blog/customize-outputformatter" target="_blank">7 - Outputformatter</a></li>
  <li><a href="/blog/customize-modelbinders" target="_blank">8 - Modelbinders </a></li>
  <li><a href="/blog/customize-actionfilters" target="_blank">9 - Actionfilters</a></li>
  <li><a href="/blog/customize-taghelpers" target="_blank">10 - Taghelpers</a></li>
  <li><a href="/blog/customize-webhostbuilder" target="_blank">11 - Webhostbuilder</a></li>
  <li><a href="/blog/customize-hosting" target="_blank">12 - Hosting </a></li>
</ul>

<!--Section: Lesson UI-->
<section class="text-center">
    <hr />
   
    <div class="row">
        <div class="col-lg-4 col-md-6 col-sm-6">
            <a target="_blank" href="/blog/customize-middleware" class="btn  btn-sm" id="round-button">
                <i class="fas fa-arrow-left mr-2"></i>Previous Lesson
            </a>
        </div>
     
        <div class="col-lg-4 col-md-6 col-sm-6">
            <a target="_blank" href="/blog/customize-modelbinders" class="btn btn-sm" id="round-button">Next Lesson
                <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>       
    </div>

</section>


                </div>

                

                <div id="disqus_thread"></div>
                <script>
                
                /**
                *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
                /*
                var disqus_config = function () {
                this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                };
                */
                (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');
                s.src = 'https://girishgodage-github-io.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
                })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



            </div>
        </div>
    </div>
    <!-- Go To Top-->
<button onclick="topFunction()"
id="myBtn"
title="Go to top"> <i class="fa fa-chevron-up"  style="font-size:36px"></i>
</button>
<!-- Footer-->
<footer class="main-footer">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-6 text-center text-lg-left">
                <p class="social">
                    <a href="https://www.facebook.com/girish.godage.5" class="external facebook wow fadeInUp">
                        <i class="fa fa-facebook"></i></a>
                    <a href="https://instagram.com/girishgodage_007" data-wow-delay="0.2s" class="external instagram wow fadeInUp">
                        <i class="fa fa-instagram"></i></a>
                    <a href="https://youtube.com/girishgodage" data-wow-delay="0.4s" class="external youtube wow fadeInUp">
                        <i class="fa fa-youtube-play"></i></a>
                    <a href="https://twitter.com/GGodage" data-wow-delay="0.4s" class="external twitter wow fadeInUp">
                            <i class="fa fa-twitter"></i></a>
                    <a href="https://github.com/girishgodage" data-wow-delay="0.4s" class="external github wow fadeInUp">
                                <i class="fa fa-github"></i></a>    
                    <a href="mailto:girishgodage@gmail.com?subject=Hello%20Girish" data-wow-delay="0.6s" class="email wow fadeInUp">
                        <i class="fa fa-envelope"></i></a></p>
            </div>
            <div class="col-12 col-md-2">
            <h5>Quick Links</h5>
            <ul>
               <li><a href="http://localhost:4000#about">About</a></li>
               <li><a href="http://localhost:4000#contact">Contact</a></li>
               <li><a href="http://localhost:4000/sitemap.xml">Sitemap</a></li>               
            </ul>
         </div>
            <div class="col-12 col-md-4 text-center text-lg-right mt-4 mt-lg-0">
                <p> <b>©</b><script>document.write(new Date().getFullYear())</script> Girish Godage </p>
                <p class="text-center, text-shadow"> Hosted On <a href="https://pages.github.com/">GitHub Pages</a></p>
            </div>
        </div>
    </div>
</footer>
    <!-- Typed.js DONT TOUCH THIS! -->
    <div id="typed-strings">
    </div>

        <!-- JavaScript files-->
    <script src="http://localhost:4000/sitejs/jquery/jquery.min.js"></script>
    <script src="http://localhost:4000/sitejs/popper.js/umd/popper.min.js"> </script>
    <script src="http://localhost:4000/sitejs/bootstrap/js/bootstrap.min.js"></script>
    <script src="http://localhost:4000/sitejs/jquery.cookie/jquery.cookie.js"> </script>
    <script src="http://localhost:4000/sitejs/owl.carousel/owl.carousel.min.js"></script>
    <script src="http://localhost:4000/sitejs/waypoints/lib/jquery.waypoints.min.js"></script>
    <script src="http://localhost:4000/sitejs/jquery.counterup/jquery.counterup.js"></script>
    <script src="http://localhost:4000/js/front.js"></script>
    <script src="http://localhost:4000/js/comment.js"></script>
       <!-- Script pointing to search-script.js -->
    <script src="http://localhost:4000/js/search-script.js" type="text/javascript"></script>
   
    <!-- Configuration -->
    <script>
         SimpleJekyllSearch({
         searchInput: document.getElementById('search-input'),
         resultsContainer: document.getElementById('results-container'),
         json: 'http://localhost:4000/search.json'
         })
         </script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.2.0/firebase.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-analytics.js"></script>

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyC36FUDDdOTidZJ8nzS5vfE7KVyayenKPE",
    authDomain: "githubcontactlist.firebaseapp.com",
    databaseURL: "https://githubcontactlist.firebaseio.com",
    projectId: "githubcontactlist",
    storageBucket: "githubcontactlist.appspot.com",
    messagingSenderId: "899685398702",
    appId: "1:899685398702:web:0c23c56d2d6d40df37553f",
    measurementId: "G-YWBRCYJYFW"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>
<script>
   $(function() {
      
    //make a variable to keep track of data coming from firebase
    var data = [];

    // Reference messages collection
      var messagesRef = firebase.database().ref('contactformmessages');  


    //listen to data updates from firebase
    messagesRef.on("value", function(snapshot) {
        console.log(snapshot.val());
        //when the data updates at firebase, put it in the data variable
        data = snapshot.val();
    })
    //Entire Contact Form (handler)
    $('#contactForm').submit(function(e) {
      e.preventDefault();

        var $form = $(this);
        console.log("Submit to Firebase");

        //disable submit button
        $form.find("#sendForm").prop('disabled', true);

        //get values to send to Firebase
        var name = $('#name').val();
        console.log(name);
		
		var surname = $('#surname').val();
        console.log(surname);
		
		var email = $('#email').val();
        console.log(email);	
		
		var phone = $('#phone').val();
        console.log(phone);

        var message = $('#message').val();
        console.log(message);

       
        //take the values from the form, and put them in an object
        var newContact = {
         "name": name,
			"surname": surname,
			"email": email,
			"phone": phone,
         "message": message
        }
        //put new object in data array
        data.push(newContact);
        console.log(data);

        //send the new data to Firebase
        messagesRef.set(data, function(err) {
            if (err) {
                alert("Data no go");
            }else{
            $("#form-wrapper").slideToggle();
            $('#form-success-message').slideToggle();
			}
        });

        return false;
    })
   
    
})
</script>

<script>

    function disableScrolling() {
        let x = window.scrollX;
        let y = window.scrollY;
        window.onscroll = function () { window.scrollTo(x, y); };
    }

    function enableScrolling() {
        window.onscroll = function () { };
    }

    // Add copy button
    let pres = document.getElementsByTagName('pre');
    Array.from(pres).forEach((element2) => {
        let element = document.createElement('button');
        element.setAttribute('class', 'btn btn-primary');
        element.innerHTML = 'Copy';
        element.style.float = 'right';

        element.addEventListener('click', (e) => {
            disableScrolling();
            console.log(e)
            let x = window.screenX;
            let y = window.screenY;

            element.innerHTML = 'copied';
            let tarea = document.createElement('textarea');
            tarea.innerHTML = element.parentElement.children[1].innerText;
            document.body.append(tarea);
            tarea.focus();
            tarea.select();
            document.execCommand('copy');
            tarea.style.display = 'none';
            setTimeout(() => {
                element.innerHTML = 'Copy';
            }, 2000);
            setTimeout(() => {
                enableScrolling();
            }, 0);
        })
        element2.insertBefore(element, element2.children[0]);
    })

    //Get the button
    myBtton = document.getElementById("myBtn");
    window.onscroll=function()
    {
        scrollFunction();
    }
    function scrollFunction(){
        if (document.body.scrollTop > 20 ||
        document.documentElement.scrollTop >20)
        {
            myBtton.style.display="block";           
        }else
        {
           myBtton.style.display="none";     
          
        }
    }
    //When user click on the top button
    function topFunction(){
      //  document.body.scrollTop =0;
      //  document.documentElement.scrollTop=0;
        $("html, body").animate({
            scrollTop: 0
        }, 600);
        return false;
    }

</script>

    
    


</body>

</html>